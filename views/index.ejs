<% title = "AForums.com - Discussion Forum" %>

<div class="forum-container">
  <% if (locals.user) { %>
    <div class="create-post-header">
      <button id="createPostBtn" class="create-post-btn">
        <span class="btn-icon">+</span>
        Create Post
      </button>
    </div>
  <% } %>
  
  <% if (posts.length === 0) { %>
    <div class="no-posts-message">
      <h2>Welcome to AForums.com!</h2>
      <p>No posts yet. <% if (locals.user) { %>Create the first post above!<% } else { %><a href="/login">Login</a> or <a href="/register">Register</a> to create the first post!<% } %></p>
    </div>
  <% } %>
  
  <% posts.forEach(post => { %>
    <div class="post">
      <div class="post-user">
        <img src="<%= post.avatar %>" alt="Avatar for <%= post.username %>">
        <h4><%= post.username %></h4>
        <div class="badges">
          <% post.badges.forEach(b => { %>
            <span class="badge <%= b %>"><%= b %></span>
          <% }) %>
        </div>
      </div>
      <div class="post-content">
        <h2 class="post-subject"><a href="/post/<%= post.id %>"><%= post.subject %></a></h2>
        <div class="post-body"><%= post.body %></div>
        <% if (post.image) { %>
          <div class="post-image">
            <img src="<%= post.image %>" alt="Post image" class="content-image">
          </div>
        <% } %>
        <div class="post-time">Posted on <%= new Date(post.time).toLocaleString() %></div>
      </div>
    </div>
  <% }) %>
</div>

<!-- Create Post Modal -->
<% if (locals.user) { %>
<div id="createPostModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Create New Post</h3>
      <span class="close">&times;</span>
    </div>
    <div class="modal-body">
      <form method="POST" action="/create-post" class="post-form" enctype="multipart/form-data">
        <div class="form-group">
          <label for="modal-subject">Subject:</label>
          <input type="text" id="modal-subject" name="subject" required placeholder="Enter post subject...">
        </div>
        <div class="form-group">
          <label for="modal-body">Body:</label>
          <textarea id="modal-body" name="body" rows="6" required placeholder="Write your post content here..."></textarea>
        </div>
        <% if (process.env.NODE_ENV !== 'production') { %>
        <div class="form-group">
          <label for="modal-image">Image (Optional):</label>
          <input type="file" id="modal-image" name="image" accept="image/*" class="file-input">
          <small class="help-text">Max size: 5MB. Accepted formats: JPG, PNG, GIF, WebP</small>
        </div>
        <% } else { %>
        <div class="form-group">
          <small class="help-text">Image uploads are disabled in production due to hosting limitations</small>
        </div>
        <% } %>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary cancel-btn">Cancel</button>
          <button type="submit" class="btn create-btn">Create Post</button>
        </div>
      </form>
    </div>
  </div>
</div>
<% } %>
